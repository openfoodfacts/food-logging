# Food Consumption Logging Data Exchange Standard

## Objective

The reason for developing a standard for food logging data exchange is to ensure that people are not locked in to a single application once they start logging their food consumption. For example, they might want to switch to a different application for logging, use another application to analyze their food logging history or supply data to a third party, such as researchers or medical practitioners.

## Glossary

The following terms are used throughout this project:

<table>
    <thead>
        <tr>
            <th>Entity</th>
            <th>Description</th>
            <th>Examples</th>
            <th>Also known as</th>
        <tr>
    </thead>
    <tbody>
        <tr>
            <td>Consumer</td>
            <td>The individual that this food log relates to. Might not be a person, e.g. in the case of a pet food diary</td>
            <td>Me, John Smith</td>
            <td>User, Person</td>
        </tr>
        <tr>
            <td>Food</td>
            <td>Something that can be ingested, in the form that it was procured by the Consumer</td>
            <td>Apple, Lasagne, Soda</td>
            <td>Product, fruit, vegetable</td>
        </tr>
        <tr>
            <td>Source</td>
            <td>Where data about a Food or Food Facet came from</td>
            <td>Producer, Label, CIQUAL</td>
            <td>Provenance</td>
        </tr>
        <tr>
            <td>Facet</td>
            <td>Any kind of information about food that can be aggregated to give insights into nutrition, health, the environment, etc.</td>
            <td>234 kJ per 100g, 68g CO<sub>2</sub> per 100ml</td>
            <td>Nutrients, Environmental Footprint</td>
        </tr>
        <tr>
            <td>Facet Type</td>
            <td>Description of the facet and its unit of measure per 100g / 100ml of the food</td>
            <td>kJ, Carbohydrates, CO<sub>2</sub>, Land usage</td>
            <td>Attribute</td>
        </tr>
        <tr>
            <td>Recipe</td>
            <td>A collection of Foods that are combined to form a component of a Meal</td>
            <td>(for a cake) 100g flour, 50g sugar, 50g butter</td>
            <td>Course, Plate, Dish, Ingredients</td>
        </tr>
        <tr>
            <td>Preparation</td>
            <td>The way that the Food is processed before eating</td>
            <td>Baked, Fried, Re-heated</td>
            <td>Processing</td>
        </tr>
        <tr>
            <td>Meal</td>
            <td>An occasion when Food was consumed</td>
            <td>This morning's breakfast</td>
            <td>Snack</td>
        </tr>
        <tr>
            <td>Meal Type</td>
            <td>Classification of the nature and timing of the meal</td>
            <td>Breakfast, Lunch, Snack</td>
            <td></td>
        </tr>
    </tbody>
</table>

## Standard

This standard defines two modes for exchanging food consumption logging data.

### Interactive Import / Export

This mode might be used by a Consumer who wishes to analyze their own data or bulk transfer data between applications or other third parties.

Exports are packaged in a zip file with an arbitrary name (determined by the user). Each zip file will contain the following:

* meals.csv
* meals_metadata.json

#### Meals

This is a CSV file to make it as simple as possible for moderately technical Consumers or delegated third-parties to analyze their own data in a spreadsheet or database. All column names should be human readable in the user's chosen language. A Metadata file will cross-reference the column names against pre-defined properties, like Meal time, Meal Type, Food and Nutrients.

Foods will include the human readable name, e.g. "Baked Beans", that was presented to the user when they selected the Food.

Date times will be recorded in the user's local format and timezone, as identified in the metadata. Items consumed as part of the same meal should have exactly the same date time to allow grouping of Meals for display or analysis purposes.

All date times in the Meals CSV file will be formatted according to the default associated with their locale as would be generated by the [JavaScript Intl.DateTimeFormat](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/DateTimeFormat/DateTimeFormat) object or equivalent.

However, numbers in both the Meals CSV and Metadata files should follow the [JSON number standard](https://www.rfc-editor.org/rfc/rfc8259#page-7) to avoid the need for unnecessary CSV escaping in regions that normally use a comma as the decimal separator.

Facets, like Nutrients, will have a single column name with a consistent unit of measure (identified in the metadata). The exporter could choose to include the unit in the column name if they feel this would be helpful. All Facets that were retrieved from the Source of the Food information that were either presented to the user or used in calculations should be included in the export.

It is suggested that fields of less interest to the Consumer, such as the Source, Global Trade Item Number (GTIN) and Image URLs are included at the "end" of the export line (this might be the leftmost columns in a right to left language).

An example might look like this (formatted as a table):

<table>
    <thead>
        <tr>
            <th>Time</th>
            <th>Meal</th>
            <th>Recipe</th>
            <th>Food</th>
            <th>Amount</th>
            <th>Measure</th>
            <th>Quantity</th>
            <th>Unit</th>
            <th>Protein</th>
            <th>Carbohydrate</th>
            <th>Fat</th>
            <th>Source</th>
            <th>Code</th>
            <th>Image</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>1-May-2025 6:00am</td>
            <td>Breakfast</td>
            <td></td>
            <td>Kelloggs Corn Flakes</td>
            <td>1</td>
            <td>serving</td>
            <td>30</td>
            <td>g</td>
            <td>0.3</td>
            <td>24</td>
            <td>1</td>
            <td>GTIN</td>
            <td>5059319030487</td>
            <td>https://images.openfoodfacts.org/images/products/505/931/903/0487/front_en.3.400.jpg</td>
        </tr>
        <tr>
            <td>1-May-2025 6:00am</td>
            <td>Breakfast</td>
            <td></td>
            <td>Full Fat Milk</td>
            <td>0.5</td>
            <td>pint</td>
            <td>284</td>
            <td>ml</td>
            <td>3.1</td>
            <td>10.2</td>
            <td>4.3</td>
            <td>GTIN</td>
            <td>5060066960071</td>
            <td>https://images.openfoodfacts.org/images/products/506/006/696/0071/front_en.3.400.jpg</td>
        </tr>
        <tr>
            <td>1-May-2025 9:00am</td>
            <td>Snack</td>
            <td>White Coffee</td>
            <td>Instant Coffee Powder</td>
            <td>1</td>
            <td>teaspoon</td>
            <td>4</td>
            <td>g</td>
            <td>0</td>
            <td>0.1</td>
            <td>0</td>
            <td>GTIN</td>
            <td>4056489440628</td>
            <td>https://images.openfoodfacts.net/images/products/405/648/944/0628/front_en.26.400.jpg</td>
        </tr>
        <tr>
            <td>1-May-2025 9:00am</td>
            <td>Snack</td>
            <td>White Coffee</td>
            <td>Full Fat Milk</td>
            <td>20</td>
            <td>ml</td>
            <td>20</td>
            <td>ml</td>
            <td>1.3</td>
            <td>1.2</td>
            <td>1.2</td>
            <td>GTIN</td>
            <td>5060066960071</td>
            <td>https://images.openfoodfacts.org/images/products/506/006/696/0071/front_en.3.400.jpg</td>
        </tr>
    </tbody>
</table>

#### Metadata

The Metadata in an export provides a translation between the human readable column names and enumerations used in the Meals file and standardized representations of these. Applications with limited user-customization could potentially hard-code this Metadata file (per user language supported) if their exports always include the same standard column names.

The main component of the Metadata file is the "columns" property which is a single object with a key for each column name mentioned in the Meals CSV file. The value associated with each column is an object whose "type" column will determine the standardized property the column represents. Additional attributes, specific to the type, will identify other data relevant to that property, e.g. the standard nutrient code and unit for a "facet" column.

The JSON Schema for a Metadata object can be found [here](schemas/metadata-file.yaml) and is further described [here](schemas/README.md#tocS_metadata).

### API Packaging

Storing and retrieving data via an API would be performed by an application rather than a user, so there is no requirement to support localization of fields or units. However, it is still important to store the data that was presented to the user, such as the Food name, as it may not be possible to re-create this from the source.

The OpenAPI specification for the API can be found [here](schemas/openapi.yaml) and is described [here](schemas/README.md).

## Development

Separate [documentation](docs/dev.md) describe various tools that may need to be run when the API document is changed

## Testing

A set of Python tests are included to validate the API schemas. Further documentation on this can be found [here](docs/test.md)
